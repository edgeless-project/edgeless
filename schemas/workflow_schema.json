{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SpawnWorkflowRequest",
  "type": "object",
  "required": [
    "annotations",
    "functions",
    "resources"
  ],
  "properties": {
    "annotations": {
      "description": "Workflow specific annotations.",
      "type": "object",
      "additionalProperties": {
        "type": "string"
      }
    },
    "functions": {
      "description": "All the functions used in this workflow.",
      "type": "array",
      "items": {
        "$ref": "#/definitions/WorkflowFunction"
      }
    },
    "resources": {
      "description": "All the resources used in this workflow.",
      "type": "array",
      "items": {
        "$ref": "#/definitions/WorkflowResource"
      }
    }
  },
  "definitions": {
    "FunctionClassSpecification": {
      "type": "object",
      "required": [
        "function_type",
        "id",
        "outputs",
        "version"
      ],
      "properties": {
        "binary": {
          "description": "WASM: inline function's code. CONTAINER: None.",
          "type": [
            "array",
            "null"
          ],
          "items": {
            "type": "integer",
            "format": "uint8",
            "minimum": 0.0
          }
        },
        "code": {
          "description": "(optional) Only relevant in a workflow. WASM: path to an object file with the binary of the function's code. CONTAINER: the image:tag",
          "type": [
            "string",
            "null"
          ]
        },
        "function_type": {
          "description": "Run-time agent type this function is made for. One of: RUST_WASM or CONTAINER;",
          "type": "string"
        },
        "id": {
          "description": "ID / Class name of the function",
          "type": "string"
        },
        "outputs": {
          "description": "Defines the outputs of this function; these outputs can be then mapped in the workflow. Should not contain duplicated outputs. Can be empty.",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "version": {
          "description": "Semantic versioning; defined by the function developer",
          "type": "string"
        }
      }
    },
    "WorkflowFunction": {
      "type": "object",
      "required": [
        "annotations",
        "class_specification",
        "name",
        "output_mapping"
      ],
      "properties": {
        "annotations": {
          "description": "Key-value pairs of annotations for the function.",
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "class_specification": {
          "description": "Specifies the class of the function using the function spec; NOTE: optional field code must be specified here.",
          "allOf": [
            {
              "$ref": "#/definitions/FunctionClassSpecification"
            }
          ]
        },
        "name": {
          "description": "Logical name of the function within this workflow. This name shall be used for mapping of outputs.",
          "type": "string"
        },
        "output_mapping": {
          "description": "Maps the output of a function to the input of another function or resource. Uses the function / resource (logical) name as defined by the \"name\" property within the workflow spec.",
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        }
      }
    },
    "WorkflowResource": {
      "type": "object",
      "required": [
        "class_type",
        "configurations",
        "name",
        "output_mapping"
      ],
      "properties": {
        "class_type": {
          "description": "Specifies the class of the resource used; Example resources: [\"http-ingress\", \"http-egress\", \"file-log\", \"redis\", \"dda\"].",
          "type": "string"
        },
        "configurations": {
          "description": "Key-value configuration of the resource instance.",
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "name": {
          "description": "Logical name of the resource instance within this workflow. It should be used to map outputs of functions to this resource inputs.",
          "type": "string"
        },
        "output_mapping": {
          "description": "Maps the outputs of this resource to functions. Some resources may provide standard outputs that must be mapped - consult the documentation to find out more.",
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        }
      }
    }
  }
}